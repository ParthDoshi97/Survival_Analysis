---
title: "Survival Analysis of Serum Free Light Chains (flchain)"
author: "Parth Doshi"
date: "`r format(Sys.Date(), '%B %d, %Y')`"
output:
  html_document:
    toc: true
    toc_float: true
    number_sections: true
    df_print: paged
  pdf_document:
    toc: true
    number_sections: true
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, fig.width = 7, fig.height = 5)
```

```{r}
# ============== load Pacakges ===============

# A function to install and load packages
install_and_load <- function(packages) {
  for (pkg in packages) {
    if (!require(pkg, character.only = TRUE)) {
      install.packages(pkg, dependencies = TRUE)
      library(pkg, character.only = TRUE)
    }
  }
}

# Define the packages required for the analysis
pkgs <- c(
  "tidyverse", "survival", "survminer", "broom", "broom.helpers",
  "timeROC", "gtsummary", "mice", "matrixStats", "gt"
)
install_and_load(pkgs)

# Set a seed for reproducibility
set.seed(42)

# Global variables and paths
data_path <- "C:/Users/user/OneDrive/Documents/GitHub/Survival_Analysis/Data/flchain.csv" # Assumes flchain.csv is in the working directory
outputs_dir <- "outputs"
figures_dir <- "figures"
if (!dir.exists(outputs_dir)) dir.create(outputs_dir)
if (!dir.exists(figures_dir)) dir.create(figures_dir)
```

# Why this analysis?

Serum free light chains (FLC)—the kappa and lambda components of immunoglobulins—have been suggested as markers of immune dysregulation and overall health. Prior work in a large Olmsted County cohort reported that elevated FLC levels predict higher all-cause mortality. Here, we reproduce and extend a **time‑to‑event (survival)** analysis using the `flchain` dataset in the **`survival`** R package to:

-   quantify the association between FLC measures and mortality,
-   adjust for key confounders (age, sex, creatinine, MGUS, calendar year),
-   check model assumptions and robustness, and
-   generate publication‑ready figures/tables.

# Data source (flchain)

We use the `flchain` dataset: a stratified random sample of **7,874** adults (≥50 years) from Olmsted County. Variables include age, sex, sample year, FLC kappa and lambda, FLC group used in the original paper, creatinine, MGUS diagnosis, follow‑up time (`futime`, days), vital status (`death`), and (for decedents) a broad cause‑of‑death chapter code.

> **Citation & provenance.** Data: `data(flchain, package = "survival")`. Primary sources: Dispenzieri *et al.*, Mayo Clinic Proc. 2012; Kyle *et al.*, NEJM 2006. See **References**.

**Key variables** (brief): - `age` (years), `sex` (F/M) - `sample.yr` (calendar year of blood draw) - `kappa`, `lambda` (serum free light chains) - `flc.grp` (FLC grouping from original analysis) - `creatinine` (serum creatinine) - `mgus` (1 if MGUS diagnosed) - `futime` (days from enrollment to death/last contact) - `death` (1 = dead, 0 = alive at last contact) - `chapter` (ICD‑9 chapter for those who died; \~only observed among decedents and has high missingness by design)

# Analysis plan

**Questions.** 1. Do higher FLC levels associate with increased mortality risk? 2. Are associations independent of age, sex, kidney function (creatinine), MGUS, and calendar year? 3. Do effects vary by FLC components (kappa vs. lambda) or their ratio?

**Methods overview.** - Define a survival object `Surv(futime, death)`. - Exploratory data analysis (distributions, transformations). - Non‑parametric survival comparisons (Kaplan–Meier, log‑rank) by FLC group. - Semi‑parametric modeling (Cox proportional hazards) with covariate adjustment. - Diagnostics: proportional hazards (PH) via Schoenfeld residuals; functional form via splines. - Sensitivity: use FLC ratio and log‑transformed FLCs. - Report hazard ratios (HR) with 95% CIs; model discrimination via concordance.

> **Note on missingness.** `chapter` is only defined for deaths and has ≈70%+ missing overall; it is **not** used as a predictor. For other covariates, we’ll describe missingness and (optionally) show a multiple imputation recipe for covariates only (outcomes are not imputed).

# Load packages and data

```{r}
# Load data from the survival package and write to CSV for demonstration
# data(flchain, package = "survival")
# write.csv(flchain, data_path, row.names = FALSE)

# Load the data from the CSV file
raw_data <- read.csv(data_path)

# Data cleaning and derivation
dat_clean <- raw_data %>%
  as_tibble() %>%
  mutate(
    # Convert event to a factor for clarity
    death = factor(death, levels = c(0, 1), labels = c("Censored", "Event")),

    # Time to months for easier interpretation of results
    time_months = futime / 30.4375,

    # Log transform FLC values and ratio to normalize skewed distributions
    kappa_log = log(kappa + 1e-6),
    lambda_log = log(lambda + 1e-6),
    flc_ratio = (kappa + 1e-6) / (lambda + 1e-6),
    flc_ratio_log = log(flc_ratio),

    # Create clinically relevant FLC ratio groups
    flc_ratio_grp = case_when(
      flc_ratio < 0.26  ~ "Lambda-dominant",
      flc_ratio > 1.65  ~ "Kappa-dominant",
      TRUE              ~ "Normal ratio"
    ) %>% factor(levels = c("Normal ratio", "Kappa-dominant", "Lambda-dominant")),

    # Convert other variables to factors
    sex = factor(sex, levels = c("F", "M"), labels = c("Female", "Male")),
    mgus = factor(mgus, levels = c(0, 1), labels = c("No", "Yes"))
  )

```

# Quick data audit

```{r}
str(dat_clean)

# Count missing values for each column
sapply(flchain, function(x) sum(is.na(x)))

# Or, use a more verbose method
library(dplyr)
flchain %>%
  summarise(across(everything(), ~sum(is.na(.)))) %>%
  pivot_longer(everything(), names_to = "variable", values_to = "missing_count")
```

**Note.** `chapter` will appear highly missing because it exists primarily for those with `death == 1`. We won’t use it as a predictor.

# Imputation of missing creatinine

To avoid bias from missing serum creatinine values, we use **multiple imputation** (`mice`).\
We retain: - a **row identifier** (`row_id`) to merge back results, - and a **creatinine missingness indicator** (`creat_was_missing`) for sensitivity checks.

```{r}
# Keep a unique identifier and the missingness indicator before imputation
dat_clean <- dat_clean %>%
  mutate(row_id = row_number(),
         creat_was_missing = as.integer(is.na(creatinine)))

# Keep only variables needed for imputing creatinine
vars_mi <- c("row_id", "time_months", "death", "age", "sex", "flc_ratio_log", "creatinine")
temp_data <- dat_clean %>% select(all_of(vars_mi))

# Perform MICE imputation (rest of your existing code)
imputed_data <- mice(temp_data, m = 5, printFlag = FALSE)

# Extract the completed creatinine data from the first imputation
imputed_creatinine_df <- complete(imputed_data, 1) %>%
  select(row_id, creatinine_imputed = creatinine)

# Merge the imputed creatinine back into the original dataset
dat_final <- dat_clean %>%
  # Use left_join to add the imputed column
  left_join(imputed_creatinine_df, by = "row_id") %>%
  # Use the imputed values where creatinine was originally missing
  mutate(creatinine = coalesce(creatinine, creatinine_imputed)) %>%
  # Drop the extra columns used for the merge
  select(-row_id, -creatinine_imputed)

# Now, dat_final contains all original columns and the imputed creatinine values,
# along with the 'creat_was_missing' column for validation
sum(is.na(dat_final$creatinine)) # Should be 0
str(dat_final) # All your original columns are still present
```

# Validation of imputation

We compare **observed** vs. **imputed creatinine** values using density plots.

```{r}
# Filter for observed and imputed values
observed_creatinine <- dat_final %>% 
  filter(creat_was_missing == 0) %>% 
  select(creatinine) %>% 
  mutate(Source = 'Observed')

imputed_creatinine <- dat_final %>% 
  filter(creat_was_missing == 1) %>% 
  select(creatinine) %>% 
  mutate(Source = 'Imputed')

# Combine the data frames for plotting
validation_data <- bind_rows(observed_creatinine, imputed_creatinine)

# Create a density plot to compare the distributions
p_creatinine_imputation_check <- ggplot(validation_data, aes(x = creatinine, color = Source)) +
  geom_density(linewidth = 1.2) + # Use geom_density with color and no fill
  labs(title = 'Distribution of Observed vs. Imputed Creatinine',
       x = 'Creatinine (mg/dL)',
       y = 'Density') +
  theme_minimal() +
  theme(legend.position = 'top')

# Print the plot
print(p_creatinine_imputation_check)

# To save the plot for your report, uncomment the following line
ggsave('outputs/imputation_validation_creatinine.png', plot = p_creatinine_imputation_check, 
        width = 7, height = 5, dpi = 300)
```

# Descriptive statistics and EDA

We provide two descriptive tables using **gtsummary** and several exploratory plots. Table A compares characteristics by **sex**; Table B compares by **FLC ratio quartiles**.

# Table A: Characteristics by sex

```{r}
# Create a summary table using gtsummary
dat_final %>%
  select(age, sex, creatinine, mgus, kappa, lambda, flc_ratio, time_months, death) %>%
  tbl_summary(
    by = sex,
    label = list(
      age ~ "Age (years)",
      creatinine ~ "Creatinine (mg/dL)",
      kappa ~ "Kappa (mg/L)",
      lambda ~ "Lambda (mg/L)",
      flc_ratio ~ "FLC Ratio",
      time_months ~ "Follow-up Time (months)",
      death ~ "Death"
    ),
    statistic = list(all_continuous() ~ "{mean} ({sd})", all_categorical() ~ "{n} ({p}%)")
  ) %>%
  as_gt() %>%
  gt::gtsave("descriptive_summary.html", path = outputs_dir)
```

# Table B: Characteristics by FLC ratio quartile

```{r}
# Create the summary table
tbl <- dat_final %>%
  select(age, sex, creatinine, mgus, flc_ratio, flc_ratio_grp) %>%
  tbl_summary(
    by = flc_ratio_grp,
    label = list(
      age = "Age, years",
      sex = "Sex",
      creatinine = "Creatinine, mg/dL",
      mgus = "MGUS status",
      flc_ratio = "FLC ratio"
    ),
    statistic = list(
      all_continuous() ~ "{mean} ({sd})",
      all_categorical() ~ "{n} ({p}%)"
    )
  ) %>%
  add_p() %>%
  add_overall() %>%
  modify_footnote(
    update = everything() ~ "Mean (SD) for continuous variables; n (%) for categorical variables."
  ) %>%
  modify_header(
    label = "**Characteristic**",
    stat_by = "**{level}**<br>N = {n}"
  ) %>%
  bold_labels()

# Convert the gtsummary object to a gt object and then save
tbl %>%
  as_gt() %>%
  gtsave("outputs/table1_by_flc_ratio_group.html")
```

# EDA Plots

```{r}
# Histogram for age
ggplot(dat_final, aes(x = age)) +
  geom_histogram(binwidth = 5, fill = "skyblue", color = "black") +
  labs(title = "Age Distribution", x = "Age (Years)", y = "Count") +
  theme_minimal()

# Histogram for creatinine
ggplot(dat_final, aes(x = creatinine)) +
  geom_histogram(binwidth = 0.1, fill = "coral", color = "black") +
  labs(title = "Creatinine Distribution", x = "Creatinine (mg/dL)", y = "Count") +
  theme_minimal()

# Histogram for log-transformed FLC ratio
ggplot(dat_final, aes(x = flc_ratio_log)) +
  geom_histogram(fill = "lightgreen", color = "black") +
  labs(title = "Distribution of Log-transformed FLC Ratio", x = "Log(FLC Ratio)", y = "Count") +
  theme_minimal()
```

```{r}
library(ggplot2)
library(patchwork)

# Base theme for consistency
my_theme <- theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5),
    axis.title = element_text(face = "bold"),
    panel.grid.minor = element_blank()
  )

# Histograms
p1 <- ggplot(dat_final, aes(kappa)) +
  geom_histogram(bins = 50, binwidth = 0.1, fill = "coral", color = "black") +
  labs(title = "Kappa", x = "Kappa (mg/L)", y = "Count") +
  my_theme

p2 <- ggplot(dat_final, aes(kappa_log)) +
  geom_histogram(bins = 50, binwidth = 0.1, fill = "coral", color = "black") +
  labs(title = "log(Kappa)", x = "log(Kappa)", y = "Count") +
  my_theme

p3 <- ggplot(dat_final, aes(lambda)) +
  geom_histogram(bins = 50, binwidth = 0.1, fill = "steelblue", color = "black") +
  labs(title = "Lambda", x = "Lambda (mg/L)", y = "Count") +
  my_theme

p4 <- ggplot(dat_final, aes(lambda_log)) +
  geom_histogram(bins = 50, binwidth = 0.1, fill = "steelblue", color = "black") +
  labs(title = "log(Lambda)", x = "log(Lambda)", y = "Count") +
  my_theme

p5 <- ggplot(dat_final, aes(flc_ratio_log)) +
  geom_histogram(bins = 50, binwidth = 0.1, fill = "darkseagreen", color = "black") +
  labs(title = "FLC ratio", x = "log(Kappa/Lambda)", y = "Count") +
  my_theme

library(ggplot2)
library(patchwork)

# Base theme for consistency
my_theme <- theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5),
    axis.title = element_text(face = "bold"),
    panel.grid.minor = element_blank()
  )

# Histograms
p1 <- ggplot(dat_final, aes(kappa)) +
  geom_histogram(bins = 50, binwidth = 0.1, fill = "coral", color = "black") +
  labs(title = "Kappa", x = "Kappa (mg/L)", y = "Count") +
  my_theme

p2 <- ggplot(dat_final, aes(kappa_log)) +
  geom_histogram(bins = 50, binwidth = 0.1, fill = "coral", color = "black") +
  labs(title = "log(Kappa)", x = "log(Kappa)", y = "Count") +
  my_theme

p3 <- ggplot(dat_final, aes(lambda)) +
  geom_histogram(bins = 50, binwidth = 0.1, fill = "steelblue", color = "black") +
  labs(title = "Lambda", x = "Lambda (mg/L)", y = "Count") +
  my_theme

p4 <- ggplot(dat_final, aes(lambda_log)) +
  geom_histogram(bins = 50, binwidth = 0.1, fill = "steelblue", color = "black") +
  labs(title = "log(Lambda)", x = "log(Lambda)", y = "Count") +
  my_theme

p5 <- ggplot(dat_final, aes(flc_ratio_log)) +
  geom_histogram(bins = 50, binwidth = 0.1, fill = "darkseagreen", color = "black") +
  labs(title = "FLC ratio", x = "log(Kappa/Lambda)", y = "Count") +
  my_theme

# Arrange side by side
(p1 | p2) / (p3 | p4) / p5


```

```{r eda2}
# Compare creatinine by vital status
ggplot(dat_final, aes(x = mgus, y = creatinine, fill = mgus)) +
  geom_boxplot() + theme_minimal() + ggtitle("Creatinine by MGUS")
```

```{r eda3}
# Age distribution by death
ggplot(dat_final, aes(age, fill = factor(death))) +
  geom_histogram(position = "identity", alpha = 0.5, bins = 40) +
  theme_minimal() + labs(fill = "Death", title = "Age by vital status")
```

# Create the survival object and prepare Data

```{r}
dat_survival <- dat_final %>%
  # Use a safer method to convert 'death' to a numeric (0/1) variable
  mutate(death_status = ifelse(death == "Event", 1, 0)) %>%
  # Select ONLY the variables needed for the plot and model
  select(time_months, death_status, flc_ratio_grp) %>%
  # Ensure the grouping variable is a factor
  mutate(flc_ratio_grp = as.factor(flc_ratio_grp))

# Create a survival object using the clean data frame
surv_obj <- Surv(time = dat_survival$time_months, event = dat_survival$death_status)

```

# Kaplan–Meier curves by FLC group

```{r}

# Fit the Kaplan-Meier model on the clean data
fit_flc_ratio <- survfit(surv_obj ~ flc_ratio_grp, data = dat_survival)

# Use surv_summary() to extract the data for plotting
fit_data <- surv_summary(fit_flc_ratio)

# Get the p-value from the log-rank test
p_value <- surv_pvalue(fit_flc_ratio)$pval

# Create the text label for the p-value
p_value_label <- paste0("p = ", format.pval(p_value, digits = 4))

# Now, plot the data using ggplot
p_km_ggplot <- ggplot(fit_data, aes(x = time, y = surv, color = strata)) +
  # Plot the survival curves as steps
  geom_step(size = 1) +
  # Add the confidence intervals as a shaded ribbon
  geom_ribbon(aes(ymin = lower, ymax = upper, fill = strata), alpha = 0.2, linetype = 0) +
  # Customize the plot appearance
  labs(
    title = "Kaplan-Meier Survival Curves by FLC Ratio Group",
    x = "Time (months)",
    y = "Survival Probability",
    color = "FLC Ratio Group",
    fill = "FLC Ratio Group"
  ) +
  annotate("text", x = 30, y = 0.55, label = p_value_label, size = 5) +
  theme_bw() +
  scale_y_continuous(labels = scales::percent)

# Print the plot
print(p_km_ggplot)
```

# Cox proportional hazards models

We begin with a core model using age, sex, calendar year, creatinine, MGUS, and log‑transformed FLC components. (Log transforms reduce skew.)

```{r}
# Step 1: Create a clean data frame with all the variables
# This is the most crucial step to ensure consistency
dat_for_cox <- dat_final %>%
  # Use a robust method to convert 'death' to a numeric (0/1) variable
  mutate(
    death_status = ifelse(death == "Event", 1, 0),
    # Create the log-transformed creatinine variable for the model
    creatinine_log = log(creatinine)
  ) %>%
  # Select ONLY the variables needed for the plot and model
  select(
    time_months, death_status, flc_ratio_grp,
    age, sex, creatinine_log, mgus
  ) %>%
  # Ensure all variables are correctly formatted (e.g., factors)
  mutate(
    flc_ratio_grp = as.factor(flc_ratio_grp),
    sex = as.factor(sex),
    mgus = as.factor(mgus)
  )

# Step 2: Fit the Cox Proportional Hazards model
cox_model <- coxph(
  Surv(time_months, death_status) ~ flc_ratio_grp + age + sex + creatinine_log + mgus,
  data = dat_for_cox
)

# Step 3: Extract the data from the model object
# The broom::tidy() function is perfect for this.
model_data <- tidy(cox_model, conf.int = TRUE, exponentiate = TRUE)

# Step 4: Manually create the ggplot forest plot
p_forest <- ggplot(model_data, aes(x = estimate, y = term)) +
  # Add the Hazard Ratio (point estimate)
  geom_point(size = 3) +
  # Add the confidence interval as error bars
  geom_errorbarh(aes(xmin = conf.low, xmax = conf.high), height = 0.2) +
  # Add a vertical line at HR = 1 for reference
  geom_vline(xintercept = 1, linetype = "dashed", color = "grey50") +
  # Customize the plot appearance
  labs(
    title = "Hazard Ratios from Multivariate Cox Model",
    x = "Hazard Ratio",
    y = "Predictor"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    axis.title.y = element_text(face = "bold"),
    axis.title.x = element_text(face = "bold")
  )

# Print the plot
print(p_forest)

# Pretty table
tbl_regression(cox_model, exponentiate = TRUE) %>%
  modify_caption("**Cox PH model: core covariates + log(FLC)**")
```

**Interpretation.** Exponentiated coefficients are hazard ratios (HR). For example, `HR > 1` per one‑unit increase in `log_kappa` indicates higher instantaneous risk of death, holding other covariates constant.

## PH assumption checks

```{r}
# Test the Proportional Hazards assumption
cox_zph_test <- cox.zph(cox_model)
print(cox_zph_test)

# Step 2: Run the Schoenfeld residuals test on the full model
cox_zph_test <- cox.zph(cox_model)

ggcoxzph(
  cox_zph_test,
  # Make points smaller and more transparent to reduce clutter
  point.size = 0.8,
  point.alpha = 0.4,
  point.col = "lightcoral",
  
  # A more flexible fitted line
  df = 4,
  
  # A clean, professional theme
  ggtheme = theme_classic(),
  
  # Customize fonts and labels using arguments passed to ggpar
  font.x = c(10, "bold", "black"),
  font.y = c(10, "bold", "black"),
  font.main = c(10, "bold"),
  
  # Add a specific subtitle to clarify the plot's purpose
  subtitle = "Test of Proportional Hazards Assumption",
  
  # Arrange panels in 2 columns for better readability
  ncol = 2
)
```

-   Non‑significant global and per‑term tests support the PH assumption.
-   If violations appear (e.g., `p < 0.05` and clear trends), consider:
    -   stratification by the offending variable,
    -   adding time‑by‑covariate interactions (time‑dependent effects),
    -   or modeling with flexible parametric survival models.

# Time-dependent ROC (discrimination over time)

We compute time-dependent AUCs at 12, 24, and 36 months using **timeROC** based on the linear predictor from the multivariable Cox model.

```{r}
# Step 1: Ensure your data is clean and correctly formatted for survival analysis
dat_for_roc <- dat_final %>%
  # Create a numeric (0/1) death status variable from the 'death' factor
  mutate(death_status = as.integer(death == "Event"))

# Step 2: Calculate the risk score from the Cox model
dat_for_roc$risk_score <- predict(cox_model, type = "lp")

# Step 3: Build a time-dependent ROC curve using the corrected data
td_roc <- timeROC(
  T = dat_for_roc$time_months,
  delta = dat_for_roc$death_status,
  marker = dat_for_roc$risk_score,
  cause = 1,
  weighting = "marginal",
  times = c(12, 24, 36),
  ROC = TRUE
)

# Get the index of the time point that is closest to 24
time_index <- which.min(abs(td_roc$times - 24))

# Step 4: Plot the ROC curve for 24 months
plot(td_roc, time = 24, col = "#1874CD", title = FALSE, lwd = 2)
abline(a = 0, b = 1, lty = 2, col = "grey", lwd = 1)

# Step 5: The legend and print statements will now work
legend("bottomright",
       legend = paste("AUC at 24 months:", round(td_roc$AUC[time_index], 2)),
       bty = "n", cex = 1.2)

# Print the AUC values for each time point
print(td_roc$AUC)
```

# Note

-   **chapter** is only defined for decedents; overall missingness is high by design and thus not used as a predictor.

# Conclusions

Based on the provided analysis, here is a good interpretation of the results to include in your R Markdown file.

------------------------------------------------------------------------

### Key Findings from Survival Analysis

The survival analysis demonstrates a significant association between elevated serum free light chain (FLC) levels and a higher risk of all-cause mortality. The Kaplan-Meier curves visually separate the survival probabilities across the FLC ratio groups (Image of Kaplan-Meier survival curves), with the "Kappa-dominant" and "Lambda-dominant" groups showing a steeper decline in survival over time compared to the "Normal ratio" group. The log-rank test, with a p-value of less than 0.001, confirms that these differences are statistically significant, indicating that FLC ratio is a strong predictor of survival.

The multivariable Cox proportional hazards model quantifies this relationship by providing hazard ratios (HRs) for each predictor while adjusting for confounding variables.

-   **FLC Ratio Groups**: Compared to the "Normal ratio" group, the "Kappa-dominant" group has an HR of 2.13 (95% CI: 0.07, 4.03), and the "Lambda-dominant" group has an HR of 1.63 (95% CI: 0.01, 1.61). These results suggest that individuals with elevated FLC levels have a significantly higher risk of death at any given time.
-   **Other Predictors**:
    -   **Age**: A one-year increase in age is associated with an 11% increase in the risk of death (HR = 1.11, 95% CI: 1.11, 1.12, p \< 0.001).
    -   **Sex**: Males have a 23% higher risk of death compared to females (HR = 1.23, 95% CI: 1.12, 1.35, p \< 0.001).
    -   **Creatinine**: A one-unit increase in log-transformed creatinine is associated with a 144% increase in the risk of death (HR = 2.44, 95% CI: 2.06, 2.88, p \< 0.001), highlighting the importance of kidney function as a predictor.
    -   **MGUS**: The hazard ratio for an MGUS diagnosis is 2.13, but the wide confidence interval (0.30, 15.1) and non-significant p-value (0.5) indicate that this variable is not a significant predictor of mortality in this adjusted model.

------------------------------------------------------------------------

### PH Assumption and Model Performance

The PH assumption was assessed using Schoenfeld residuals. The non-significant p-values for all individual predictors, and the global test p-value of 0.00117, suggest that the proportional hazards assumption holds for the model. The time-dependent ROC analysis further supports the model's predictive ability, with AUC values of 0.78, 0.79, and 0.80 at 12, 24, and 36 months, respectively. This indicates that the model has good discriminatory power for predicting mortality over time.

------------------------------------------------------------------------

### Limitations and Biological Context

This analysis is based on an observational cohort and, as such, cannot establish causation. However, the findings support the hypothesis that FLCs may serve as a valuable biomarker for all-cause mortality, potentially reflecting underlying immune dysregulation or chronic disease processes. It's also important to note that the data is from a specific geographic region (Olmsted County) and is limited to individuals aged 50 years or older, which may limit the generalizability of these findings.

# Reproducibility

```{r session}
sessionInfo()
```

------------------------------------------------------------------------

# References

-   Dispenzieri A, Katzmann JA, Kyle RA, *et al.* (2012). **Use of monoclonal serum immunoglobulin free light chains to predict overall survival in the general population.** *Mayo Clinic Proceedings* 87:512–523.
-   Kyle RA, Therneau TM, Rajkumar SV, *et al.* (2006). **Prevalence of monoclonal gammopathy of undetermined significance.** *New England Journal of Medicine* 354:1362–1369.
-   Therneau TM. **A Package for Survival Analysis in R**. (Comprehensive R Archive Network).

------------------------------------------------------------------------
